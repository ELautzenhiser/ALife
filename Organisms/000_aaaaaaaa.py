translation = {'098': 'char', '099': 'mutability', '212': 'interaction_result', '126': 'self_id', '210': 'loads', '211': 'type', '090': 'child_location', '091': 'numpy', '092': 'normal', '093': '30', '094': '({} % {})', '095': '1000', '096': 'intToString', '097': 'mutateChar', '133': 'w', '132': 'open', '131': 'child', '130': '.py', '137': 'genome = \\"', '015': 'world', '016': 'sight_distance', '017': 'neutrality', '018': '{} = {}', '019': '20', '139': 'close', '138': '\\"', '056': 'xrange', '127': 'splitName', '025': '0', '024': 'argv', '122': 'child_id', '123': '0.75', '124': 'makeOffspring', '020': '3', '023': '{}.{}', '022': '{}({})', '128': 'child_name', '129': '_', '029': '-1', '028': '\\\\', '010': 'getTraits', '011': 'global {}', '135': 'translation = ', '012': 'metabolism', '013': 'codon_length', '014': 'self_name', '136': 'str', '146': 'distance', '199': 'findNearbyOrganisms', '198': '-3', '200': 'location', '195': 'getAllOrganisms', '194': 'dumps', '197': 'listdir', '134': 'write', '191': 'friendliness', '203': 'organism_location', '193': 'acting_organism', '192': 'dict', '115': 'split_genome2', '114': 'split_genome1', '117': 'range', '039': 'codon', '111': 'getChildGenome', '110': '034', '113': 'cut_point', '112': 'other_genome', '032': '300', '142': 'num', '030': '/', '031': 'getcwd', '119': 'join', '037': 'getTree', '034': 'dedent', '035': 'cut', '057': '({})', '140': 'name', '173': 'Popen', '141': '.', '172': 'other_organism', '083': 'max', '052': 'count', '208': 'print {}', '170': 'message', '108': '008', '109': '036', '196': 'organism', '148': 'unique_id', '049': 'replace', '048': 'num_subacids', '047': '[{}]', '103': 'index', '045': '{} += {}', '149': 'new_name', '043': 'aacid', '042': '({} + {})', '104': 'new_char_index', '040': 'genome', '054': 'for {} in {}:', '055': 'i', '151': 'tryToMove', '150': 'rename', '176': 'bufsize', '153': 'None', '144': '({} - {})', '102': 'char_index', '152': 'end_point', '058': 'value', '059': 'append', '179': 'stdout', '178': 'PIPE', '177': 'stdin', '072': 'line', '175': '{}={}', '174': 'python', '050': '{{{{', '051': '}}}}', '171': 'getMessage', '053': '{{}}', '044': 'translation', '157': 'distance_two', '106': '009', '071': 'indent', '145': 'getNewPosition', '107': '035', '182': 'True', '183': 'full_response', '180': 'stderr', '181': 'universal_newlines', '186': 'determineFriendliness', '041': '{}:{}', '184': 'communicate', '185': 'parsed_response', '188': 'kwargs', '105': 'getCutPoint', '202': '{} != {}', '187': '**{}', '061': 'format', '060': 'try:', '063': 'except{}:', '062': '*{}', '065': 'translate', '064': '#', '067': 'code_list', '066': 'output', '069': '{} < {}', '068': 'while {}:', '190': 'other_friendliness', '168': 'choice', '169': 'interact', '164': '-shortest_distance', '165': 'initiateInteraction', '166': 'organisms', '167': 'other_name', '160': 'stimulus_direction', '161': '({} and {})', '162': '{} > {}', '163': '{}{}', '189': 'get', '046': 'new_container', '038': 'position', '116': 'child_genome', '204': '({} or {})', '076': 'else:', '077': ':', '074': '{} == {}', '075': '\\n', '155': '{} is {}', '073': 'if {}:', '070': 'len', '156': 'distance_one', '159': 'shortest_distance', '158': 'abs', '078': '({} * {})', '079': ' ', '033': '0.5', '100': 'chars', '036': 'return {}', '118': 'min', '101': '0123456789abcdefghijklmnopqrstuvwxyz', '201': 'nearby', '147': 'move', '089': 'parent_location', '088': 'getChildLocation', '205': 'react', '143': 'length', '207': 'other_location', '206': 'start_conditions', '209': 'raw_input', '082': '{} -= {}', '081': '1', '080': '4', '087': 'round', '086': 'int', '085': 'float', '084': 'floatToInt', '003': 'random', '002': 'sys', '001': '{}, {}', '000': 'import {}', '007': 'numpy.random', '006': 'subprocess', '005': 'json', '004': 'os', '154': 'motivation', '009': 'def {}({}):', '008': '', '120': 'getChildId', '121': 'parent_id', '027': "'{}'", '026': 'split', '021': '{}[{}]', '125': 'self_location'}
genome = '000001002001003001004001005001006007008009010008011012011013011014011015011016011017018012019018013020018014021022023021022023021023002024025026027028029026027030029018015022023004031008018016032018017033034008008009035008036008034008008009037038018039021040041038042038013018043021044039045038013018046047008018048022023022023022023043049001027050027008049001027051027008052027053054055022056048018057001058038022037038022023046059058034060018043022023043061062046034063008018043042027064043034036057001043038034008008009065008018066027008018067047008018038025068069038022070040018057001058038022037038022023067059058034018071025054072067073074022070072025045066027075034076073074021072029027077045066042042027075078027079078080071072045071081034076073074072027034082071081018071022083001071025034076045066042042027075078027079078080071072034034034034036066034008008009035008036008034008008009084085036022086022087001085025034008008009088089018089022086089018090022084022023023091003092001089093018090094090095036022096001090020034008008009097001098099018100027101018102022023100103098018104094022084022023023091003092001102099022070100036021100104034008008009105008036042042042042042042027106027107027108027109027108027110027108034008008009111018112027008073074112027008036040034018113022105008018114022023040026113018115022023040026113018116047008054055022117022118001022070114022070115073069022023003003008033022023116059021114055034076022023116059021115055034034036022023113119116034008008009120121018122027008054098121045122022097001098123034036122034008008009124018112027008018057001125126022127014018090022088125018122022120126018128042042042090027129122027130018116022111112018131022132001128027133022023131134042027135022136044022023131134042042042027075027137116027138022023131134022065008022023131139008034008008009127140018140021022023140026027141025036022023140026027129034008008009096001142143018142022136142054055022056144143022070142018142042027025142034036142034008008009145001038146036094042022086038146095034008008009147146011014018057001038148022127014018038022096001022145001038146020018149042042042038027129148027130022023004150001014149018014149034008008009035008036008034008008009151001018152153018154025073155152153018146022086022023023091003092001025012022147146034076018038022086021022127014025018156042144095022083001152038022118001152038018157022158144152038018159022118001156157073069152038018160029034076018160081034018146022086022023023091003092001078078160154012012073161162154025162022158146159073162146025018146159034076018146163164008034034022147146034034008008009165166018167022023003168166036022169167034008008009169167018170022171008018172022023006173001047001027174167001175176081001175177023006178001175179023006178001175180023006178175181182018183022023172184170018185021183025036185034008008009186187188073022023188189027190018191078021188027190017034076018191022023023091003092001025081034036191034008008009171187188018170022192008018021170027193014018021170027191022186187188018021170027040040036022023005194170034008008009195015018166047008054196022023004197015073074021196041198008027130022023166059196034034036166034008008009199166018200022086021022127014025018201047008054196166073202196014018203022086021022127196025073204069022158144203200016162022158144203200144095016022023201059196034034034036201034008008009205206018172022023206189027193018207022086021022127172025018190022085022023206189027191022151001207190073069022023003003008190018112022023206189027040022124112034208022171001175172172175190190034008008009035008036008034008022010008018206022209008060018206022023005210206034063008018206022192008034073202022211206192018206022192008034073155022023206189027193153022151008018166022195015018201022199166073201018212022165201034076022124008034034076022205206034'
import sys, random, os, json, subprocess, numpy.random

def getTraits():
    global metabolism
    global codon_length
    global self_name
    global world
    global sight_distance
    global neutrality
    metabolism = 20
    codon_length = 3
    self_name = sys.argv[0].split('\\')[-1].split('/')[-1]
    world = os.getcwd()
    sight_distance = 300
    neutrality = 0.5


def cut():
    return 


def getTree(position):
    codon = genome[position:(position + codon_length)]
    aacid = translation[codon]
    position += codon_length
    new_container = []
    num_subacids = aacid.replace('{{', '').replace('}}', '').count('{}')
    for i in xrange(num_subacids):
        (value, position) = getTree(position)
        new_container.append(value)
    try:
        aacid = aacid.format(*new_container)
    except:
        aacid = ('#' + aacid)
    return (aacid, position)


def translate():
    output = ''
    code_list = []
    position = 0
    while position < len(genome):
        (value, position) = getTree(position)
        code_list.append(value)
    indent = 0
    for line in code_list:
        if len(line) == 0:
            output += '\n'
        else:
            if line[-1] == ':':
                output += (('\n' + (' ' * (4 * indent))) + line)
                indent += 1
            else:
                if line == 'dedent':
                    indent -= 1
                    indent = max(indent, 0)
                else:
                    output += (('\n' + (' ' * (4 * indent))) + line)
    return output


def cut():
    return 


def floatToInt(float):
    return int(round(float, 0))


def getChildLocation(parent_location):
    parent_location = int(parent_location)
    child_location = floatToInt(numpy.random.normal(parent_location, 30))
    child_location = (child_location % 1000)
    return intToString(child_location, 3)


def mutateChar(char, mutability):
    chars = '0123456789abcdefghijklmnopqrstuvwxyz'
    char_index = chars.index(char)
    new_char_index = (floatToInt(numpy.random.normal(char_index, mutability)) % len(chars))
    return chars[new_char_index]


def getCutPoint():
    return (((((('009' + '035') + '008') + '036') + '008') + '034') + '008')


def getChildGenome(other_genome = ''):
    if other_genome == '':
        return genome
    cut_point = getCutPoint()
    split_genome1 = genome.split(cut_point)
    split_genome2 = genome.split(cut_point)
    child_genome = []
    for i in range(min(len(split_genome1), len(split_genome2))):
        if random.random() < 0.5:
            child_genome.append(split_genome1[i])
        else:
            child_genome.append(split_genome2[i])
    return cut_point.join(child_genome)


def getChildId(parent_id):
    child_id = ''
    for char in parent_id:
        child_id += mutateChar(char, 0.75)
    return child_id


def makeOffspring(other_genome = ''):
    (self_location, self_id) = splitName(self_name)
    child_location = getChildLocation(self_location)
    child_id = getChildId(self_id)
    child_name = (((child_location + '_') + child_id) + '.py')
    child_genome = getChildGenome(other_genome)
    child = open(child_name, 'w')
    child.write(('translation = ' + str(translation)))
    child.write(((('\n' + 'genome = \"') + child_genome) + '\"'))
    child.write(translate())
    child.close()


def splitName(name):
    name = name.split('.')[0]
    return name.split('_')


def intToString(num, length):
    num = str(num)
    for i in xrange((length - len(num))):
        num = ('0' + num)
    return num


def getNewPosition(position, distance):
    return ((int(position) + distance) % 1000)


def move(distance):
    global self_name
    (position, unique_id) = splitName(self_name)
    position = intToString(getNewPosition(position, distance), 3)
    new_name = (((position + '_') + unique_id) + '.py')
    os.rename(self_name, new_name)
    self_name = new_name


def cut():
    return 


def tryToMove(end_point = None, motivation = 0):
    if end_point is None:
        distance = int(numpy.random.normal(0, metabolism))
        move(distance)
    else:
        position = int(splitName(self_name)[0])
        distance_one = ((1000 - max(end_point, position)) + min(end_point, position))
        distance_two = abs((end_point - position))
        shortest_distance = min(distance_one, distance_two)
        if end_point < position:
            stimulus_direction = -1
        else:
            stimulus_direction = 1
        distance = int(numpy.random.normal(((stimulus_direction * motivation) * metabolism), metabolism))
        if (motivation > 0 and abs(distance) > shortest_distance):
            if distance > 0:
                distance = shortest_distance
            else:
                distance = -shortest_distance
        move(distance)


def initiateInteraction(organisms):
    other_name = random.choice(organisms)
    return interact(other_name)


def interact(other_name):
    message = getMessage()
    other_organism = subprocess.Popen(['python', other_name], bufsize=1, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE, universal_newlines=True)
    full_response = other_organism.communicate(message)
    parsed_response = full_response[0]
    return parsed_response


def determineFriendliness(**kwargs):
    if kwargs.get('other_friendliness'):
        friendliness = (kwargs['other_friendliness'] * neutrality)
    else:
        friendliness = numpy.random.normal(0, 1)
    return friendliness


def getMessage(**kwargs):
    message = dict()
    message['acting_organism'] = self_name
    message['friendliness'] = determineFriendliness(**kwargs)
    message['genome'] = genome
    return json.dumps(message)


def getAllOrganisms(world):
    organisms = []
    for organism in os.listdir(world):
        if organism[-3:] == '.py':
            organisms.append(organism)
    return organisms


def findNearbyOrganisms(organisms):
    location = int(splitName(self_name)[0])
    nearby = []
    for organism in organisms:
        if organism != self_name:
            organism_location = int(splitName(organism)[0])
            if (abs((organism_location - location)) < sight_distance or abs((organism_location - location)) > (1000 - sight_distance)):
                nearby.append(organism)
    return nearby


def react(start_conditions):
    other_organism = start_conditions.get('acting_organism')
    other_location = int(splitName(other_organism)[0])
    other_friendliness = float(start_conditions.get('friendliness'))
    tryToMove(other_location, other_friendliness)
    if random.random() < other_friendliness:
        other_genome = start_conditions.get('genome')
        makeOffspring(other_genome)
    print getMessage(other_organism=other_organism, other_friendliness=other_friendliness)


def cut():
    return 

getTraits()
start_conditions = raw_input()
try:
    start_conditions = json.loads(start_conditions)
except:
    start_conditions = dict()
if type(start_conditions) != dict:
    start_conditions = dict()
if start_conditions.get('acting_organism') is None:
    tryToMove()
    organisms = getAllOrganisms(world)
    nearby = findNearbyOrganisms(organisms)
    if nearby:
        interaction_result = initiateInteraction(nearby)
    else:
        makeOffspring()
else:
    react(start_conditions)