translation = {'216': 'raw_input', '217': 'loads', '214': 'other_location', '215': 'print {}', '212': 'react', '213': 'start_conditions', '210': 'organism_location', '099': 'mutability', '090': 'child_location', '091': 'numpy', '092': 'normal', '093': '30', '094': '({} % {})', '095': '1000', '218': 'type', '219': 'interaction_result', '133': 'self_location', '132': 'makeOffspring', '131': '0.75', '013': 'codon_length', '137': '_', '015': 'world', '016': 'sight_distance', '017': 'neutrality', '018': '{} = {}', '019': '20', '139': 'child', '138': '.py', '056': 'xrange', '211': '({} or {})', '105': 'mutateChar', '127': '0.15', '025': '0', '024': 'argv', '122': 'split_genome2', '123': 'range', '021': '{}[{}]', '020': '3', '098': 'num', '022': '{}({})', '128': 'getChildId', '129': 'parent_id', '097': 'mutateNum', '029': '-1', '028': '\\\\', '010': 'getTraits', '011': 'global {}', '135': 'splitName', '012': 'metabolism', '130': 'child_id', '014': 'self_name', '136': 'child_name', '201': 'dumps', '199': 'dict', '198': 'friendliness', '147': 'close', '195': 'kwargs', '194': '**{}', '197': 'other_friendliness', '134': 'self_id', '191': 'communicate', '144': 'str', '193': 'determineFriendliness', '192': 'parsed_response', '115': '036', '114': '008', '117': 'getChildGenome', '039': 'codon', '111': 'getCutPoint', '110': 'new_char_index', '113': '035', '112': '009', '032': '300', '033': '0.5', '030': '/', '031': 'getcwd', '119': 'child_genome', '118': 'other_genome', '034': 'dedent', '035': 'cut', '057': '({})', '207': 'location', '173': 'organisms', '141': 'w', '172': 'initiateInteraction', '083': 'max', '052': 'count', '208': 'nearby', '053': '{{}}', '041': '{}:{}', '108': '0123456789abcdefghijklmnopqrstuvwxyz', '109': 'char_index', '085': 'float', '049': 'replace', '048': 'num_subacids', '102': 'num_index', '103': 'index', '100': 'nums', '044': 'translation', '043': 'aacid', '042': '({} + {})', '104': 'new_num_index', '040': 'genome', '054': 'for {} in {}:', '055': 'i', '151': '({} - {})', '077': ':', '153': 'distance', '047': '[{}]', '152': 'getNewPosition', '058': 'value', '059': 'append', '179': 'other_organism', '178': 'getMessage', '177': 'message', '176': 'interact', '175': 'choice', '174': 'other_name', '050': '{{{{', '045': '{} += {}', '171': '-shortest_distance', '170': '{}{}', '203': 'organism', '101': '0123456789', '157': 'rename', '106': 'char', '071': 'indent', '145': 'genome = \\"', '107': 'chars', '182': '{}={}', '183': 'bufsize', '180': 'Popen', '181': 'python', '186': 'stdout', '187': 'stderr', '184': 'stdin', '185': 'PIPE', '188': 'universal_newlines', '189': 'True', '061': 'format', '060': 'try:', '063': 'except{}:', '196': 'get', '065': 'translate', '064': '#', '067': 'code_list', '066': 'output', '069': '{} < {}', '068': 'while {}:', '142': 'write', '190': 'full_response', '168': '({} and {})', '169': '{} > {}', '164': 'distance_two', '165': 'abs', '166': 'shortest_distance', '167': 'stimulus_direction', '160': 'None', '161': 'motivation', '162': '{} is {}', '163': 'distance_one', '150': 'length', '046': 'new_container', '038': 'position', '116': '034', '051': '}}}}', '204': 'listdir', '076': 'else:', '149': '.', '074': '{} == {}', '075': '\\n', '072': 'line', '073': 'if {}:', '070': 'len', '156': 'new_name', '159': 'end_point', '158': 'tryToMove', '078': '({} * {})', '079': ' ', '062': '*{}', '088': 'getChildLocation', '036': 'return {}', '037': 'getTree', '155': 'unique_id', '146': '\\"', '200': 'acting_organism', '089': 'parent_location', '202': 'getAllOrganisms', '205': '-3', '143': 'translation = ', '140': 'open', '206': 'findNearbyOrganisms', '209': '{} != {}', '082': '{} -= {}', '081': '1', '080': '4', '087': 'round', '086': 'int', '148': 'name', '084': 'floatToInt', '003': 'random', '002': 'sys', '001': '{}, {}', '000': 'import {}', '007': 'numpy.random', '006': 'subprocess', '005': 'json', '004': 'os', '154': 'move', '009': 'def {}({}):', '008': '', '120': 'cut_point', '121': 'split_genome1', '023': '{}.{}', '027': "'{}'", '026': 'split', '124': 'min', '096': 'intToString', '126': 'mutated_genome', '125': 'join'}
genome = '000001002001003001004001005001006007008009010008011012011013011014011015011016011017018012019018013020018014021022023021022023021023002024025026027028029026027030029018015022023004031008018016032018017033034008008009035008036008034008008009037038018039021040041038042038013018043021044039045038013018046047008018048022023022023022023043049001027050027008049001027051027008052027053054055022056048018057001058038022037038022023046059058034060018043022023043061062046034063008018043042027064043034036057001043038034008008009065040018066027008018067047008018038025068069038022070040018057001058038022037038022023067059058034018071025054072067073074022070072025045066027075034076073074021072029027077045066042042027075078027079078080071072045071081034076073074072027034082071081018071022083001071025034076045066042042027075078027079078080071072034034034034036066034008008009035008036008034008008009084085036022086022087001085025034008008009088089018089022086089018090022084022023023091003092001089093018090094090095036022096001090020034008008009097001098099018100027101018102022023100103098018104094022084022023023091003092001102099022070100036021100104034008008009105001106099018107027108018109022023107103106018110094022084022023023091003092001109099022070107036021107110034008008009111008036042042042042042042027112027113027114027115027114027116027114034008008009117018118027008073074118027008018119040034076018120022111008018121022023040026120018122022023040026120018119047008054055022123022124001022070121022070122073069022023003003008033022023119059021121055034076022023119059021122055034034018119022023120125119034018126027008054098119045126022097001098127034036126034008008009128129018130027008054106129045130022105001106131034036130034008008009132018118027008018057001133134022135014018090022088133018130022128134018136042042042090027137130027138018119022117118018139022140001136027141022023139142042027143022144044022023139142042042042027075027145119027146022023139142022065119022023139147008034008008009135148018148021022023148026027149025036022023148026027137034008008009096001098150018098022144098054055022056151150022070098018098042027025098034036098034008008009152001038153036094042022086038153095034008008009154153011014018057001038155022135014018038022096001022152001038153020018156042042042038027137155027138022023004157001014156018014156034008008009035008036008034008008009158001018159160018161025073162159160018153022086022023023091003092001025012022154153034076018038022086021022135014025018163042151095022083001159038022124001159038018164022165151159038018166022124001163164073069159038018167029034076018167081034018153022086022023023091003092001078078167161012012073168169161025169022165153166073169153025018153166034076018153170171008034034022154153034034008008009172173018174022023003175173036022176174034008008009176174018177022178008018179022023006180001047001027181174001182183081001182184023006185001182186023006185001182187023006185182188189018190022023179191177018192021190025036192034008008009193194195073022023195196027197018198078021195027197017034076018198022023023091003092001025081034036198034008008009178194195018177022199008018021177027200014018021177027198022193194195018021177027040040036022023005201177034008008009202015018173047008054203022023004204015073074021203041205008027138022023173059203034034036173034008008009206173018207022086021022135014025018208047008054203173073209203014018210022086021022135203025073211069022165151210207016169022165151210207151095016022023208059203034034034036208034008008009212213018179022023213196027200018214022086021022135179025018197022085022023213196027198022158001214197073069022023003003008197018118022023213196027040022132118034215022178001182179179182197197034008008009035008036008034008022010008018213022216008060018213022023005217213034063008018213022199008034073209022218213199018213022199008034073162022023213196027200160022158008018173022202015018208022206173073208018219022172208034076022132008034034076022212213034'
import sys, random, os, json, subprocess, numpy.random

def getTraits():
    global metabolism
    global codon_length
    global self_name
    global world
    global sight_distance
    global neutrality
    metabolism = 20
    codon_length = 3
    self_name = sys.argv[0].split('\\')[-1].split('/')[-1]
    world = os.getcwd()
    sight_distance = 300
    neutrality = 0.5


def cut():
    return 


def getTree(position):
    codon = genome[position:(position + codon_length)]
    aacid = translation[codon]
    position += codon_length
    new_container = []
    num_subacids = aacid.replace('{{', '').replace('}}', '').count('{}')
    for i in xrange(num_subacids):
        (value, position) = getTree(position)
        new_container.append(value)
    try:
        aacid = aacid.format(*new_container)
    except:
        aacid = ('#' + aacid)
    return (aacid, position)


def translate(genome):
    output = ''
    code_list = []
    position = 0
    while position < len(genome):
        (value, position) = getTree(position)
        code_list.append(value)
    indent = 0
    for line in code_list:
        if len(line) == 0:
            output += '\n'
        else:
            if line[-1] == ':':
                output += (('\n' + (' ' * (4 * indent))) + line)
                indent += 1
            else:
                if line == 'dedent':
                    indent -= 1
                    indent = max(indent, 0)
                else:
                    output += (('\n' + (' ' * (4 * indent))) + line)
    return output


def cut():
    return 


def floatToInt(float):
    return int(round(float, 0))


def getChildLocation(parent_location):
    parent_location = int(parent_location)
    child_location = floatToInt(numpy.random.normal(parent_location, 30))
    child_location = (child_location % 1000)
    return intToString(child_location, 3)


def mutateNum(num, mutability):
    nums = '0123456789'
    num_index = nums.index(num)
    new_num_index = (floatToInt(numpy.random.normal(num_index, mutability)) % len(nums))
    return nums[new_num_index]


def mutateChar(char, mutability):
    chars = '0123456789abcdefghijklmnopqrstuvwxyz'
    char_index = chars.index(char)
    new_char_index = (floatToInt(numpy.random.normal(char_index, mutability)) % len(chars))
    return chars[new_char_index]


def getCutPoint():
    return (((((('009' + '035') + '008') + '036') + '008') + '034') + '008')


def getChildGenome(other_genome = ''):
    if other_genome == '':
        child_genome = genome
    else:
        cut_point = getCutPoint()
        split_genome1 = genome.split(cut_point)
        split_genome2 = genome.split(cut_point)
        child_genome = []
        for i in range(min(len(split_genome1), len(split_genome2))):
            if random.random() < 0.5:
                child_genome.append(split_genome1[i])
            else:
                child_genome.append(split_genome2[i])
        child_genome = cut_point.join(child_genome)
    mutated_genome = ''
    for num in child_genome:
        mutated_genome += mutateNum(num, 0.15)
    return mutated_genome


def getChildId(parent_id):
    child_id = ''
    for char in parent_id:
        child_id += mutateChar(char, 0.75)
    return child_id


def makeOffspring(other_genome = ''):
    (self_location, self_id) = splitName(self_name)
    child_location = getChildLocation(self_location)
    child_id = getChildId(self_id)
    child_name = (((child_location + '_') + child_id) + '.py')
    child_genome = getChildGenome(other_genome)
    child = open(child_name, 'w')
    child.write(('translation = ' + str(translation)))
    child.write(((('\n' + 'genome = \"') + child_genome) + '\"'))
    child.write(translate(child_genome))
    child.close()


def splitName(name):
    name = name.split('.')[0]
    return name.split('_')


def intToString(num, length):
    num = str(num)
    for i in xrange((length - len(num))):
        num = ('0' + num)
    return num


def getNewPosition(position, distance):
    return ((int(position) + distance) % 1000)


def move(distance):
    global self_name
    (position, unique_id) = splitName(self_name)
    position = intToString(getNewPosition(position, distance), 3)
    new_name = (((position + '_') + unique_id) + '.py')
    os.rename(self_name, new_name)
    self_name = new_name


def cut():
    return 


def tryToMove(end_point = None, motivation = 0):
    if end_point is None:
        distance = int(numpy.random.normal(0, metabolism))
        move(distance)
    else:
        position = int(splitName(self_name)[0])
        distance_one = ((1000 - max(end_point, position)) + min(end_point, position))
        distance_two = abs((end_point - position))
        shortest_distance = min(distance_one, distance_two)
        if end_point < position:
            stimulus_direction = -1
        else:
            stimulus_direction = 1
        distance = int(numpy.random.normal(((stimulus_direction * motivation) * metabolism), metabolism))
        if (motivation > 0 and abs(distance) > shortest_distance):
            if distance > 0:
                distance = shortest_distance
            else:
                distance = -shortest_distance
        move(distance)


def initiateInteraction(organisms):
    other_name = random.choice(organisms)
    return interact(other_name)


def interact(other_name):
    message = getMessage()
    other_organism = subprocess.Popen(['python', other_name], bufsize=1, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE, universal_newlines=True)
    full_response = other_organism.communicate(message)
    parsed_response = full_response[0]
    return parsed_response


def determineFriendliness(**kwargs):
    if kwargs.get('other_friendliness'):
        friendliness = (kwargs['other_friendliness'] * neutrality)
    else:
        friendliness = numpy.random.normal(0, 1)
    return friendliness


def getMessage(**kwargs):
    message = dict()
    message['acting_organism'] = self_name
    message['friendliness'] = determineFriendliness(**kwargs)
    message['genome'] = genome
    return json.dumps(message)


def getAllOrganisms(world):
    organisms = []
    for organism in os.listdir(world):
        if organism[-3:] == '.py':
            organisms.append(organism)
    return organisms


def findNearbyOrganisms(organisms):
    location = int(splitName(self_name)[0])
    nearby = []
    for organism in organisms:
        if organism != self_name:
            organism_location = int(splitName(organism)[0])
            if (abs((organism_location - location)) < sight_distance or abs((organism_location - location)) > (1000 - sight_distance)):
                nearby.append(organism)
    return nearby


def react(start_conditions):
    other_organism = start_conditions.get('acting_organism')
    other_location = int(splitName(other_organism)[0])
    other_friendliness = float(start_conditions.get('friendliness'))
    tryToMove(other_location, other_friendliness)
    if random.random() < other_friendliness:
        other_genome = start_conditions.get('genome')
        makeOffspring(other_genome)
    print getMessage(other_organism=other_organism, other_friendliness=other_friendliness)


def cut():
    return 

getTraits()
start_conditions = raw_input()
try:
    start_conditions = json.loads(start_conditions)
except:
    start_conditions = dict()
if type(start_conditions) != dict:
    start_conditions = dict()
if start_conditions.get('acting_organism') is None:
    tryToMove()
    organisms = getAllOrganisms(world)
    nearby = findNearbyOrganisms(organisms)
    if nearby:
        interaction_result = initiateInteraction(nearby)
    else:
        makeOffspring()
else:
    react(start_conditions)